<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Terminal v7.1 (Fixed & Complete)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap');
        :root { --bg-color: #0d1117; --primary-color: #58a6ff; --card-bg: #161b22; --border-color: #30363d; --text-color: #c9d1d9; --text-secondary: #8b949e; --danger-color: #da3633; }
        body { font-family: 'Fira Code', monospace; background-color: var(--bg-color); color: var(--text-color); margin: 0; padding: 20px 20px 80px 20px; box-sizing: border-box; }
        .container { max-width: 1200px; margin: auto; }
        .panel { display: none; padding-bottom: 20px; }
        .panel.active { display: block; animation: fadeIn 0.5s; }
        .card { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 6px; padding: 25px; margin-bottom: 20px; }
        .card h2 { color: var(--primary-color); margin-top: 0; border-bottom: 1px solid var(--border-color); padding-bottom: 15px;}
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .form-group { display: flex; flex-direction: column; }
        label { margin-bottom: 8px; color: var(--text-secondary); }
        input[type="text"] { background-color: var(--bg-color); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-color); padding: 12px; font-family: inherit; }
        .photo-uploader { background: var(--bg-color); border: 2px dashed var(--border-color); border-radius: 6px; padding: 10px; text-align: center; cursor: pointer; }
        .photo-uploader img { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; margin-top: 10px; }
        .btn { background-color: #238636; color: white; border: 1px solid #2ea043; border-radius: 6px; padding: 12px 24px; font-size: 1em; cursor: pointer; width: 100%; grid-column: span 2; }
        #user-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; }
        .user-card { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 6px; padding: 20px; text-align: center; }
        .user-card .photos { display: flex; justify-content: center; margin-bottom: 15px; }
        .user-card img { width: 80px; height: 80px; border-radius: 50%; border: 3px solid #0d1117; }
        .user-card h3 { margin: 0 0 15px 0; word-wrap: break-word; }
        .user-card .actions { display: flex; gap: 10px; margin-top: 15px; }
        .btn-manage, .btn-delete { border: none; width: 100%; padding: 10px; border-radius: 6px; cursor: pointer; font-family: inherit; font-size: 1em; }
        .btn-manage { background-color: var(--primary-color); color: white; }
        .btn-delete { background-color: var(--danger-color); color: white; }
        nav.bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: #161b22; display: flex; border-top: 1px solid var(--border-color); z-index: 10; }
        nav.bottom-nav button { background: none; border: none; color: var(--text-secondary); font-size: 1em; padding: 20px; cursor: pointer; font-family: inherit; flex-grow: 1; border-top: 3px solid transparent; }
        nav.bottom-nav button.active { color: var(--primary-color); border-top-color: var(--primary-color); }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 100; }
        .modal-content { background: var(--card-bg); padding: 30px; border-radius: 8px; width: 90%; max-width: 400px; animation: fadeIn 0.3s; }
        .close-btn { float: right; font-size: 24px; cursor: pointer; }
        @media (max-width: 768px) { body { padding: 10px 10px 80px 10px; } .form-grid { grid-template-columns: 1fr; } .btn { grid-column: span 1; } #user-list { grid-template-columns: 1fr; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <div class="container">
        <!-- Dashboard Panel -->
        <div id="dashboard" class="panel active">
            <div class="card">
                <h2>Create New Secure Chat</h2>
                <form id="create-user-form">
                    <div class="form-grid">
                        <div class="form-group"><label>Friend's Info</label><input type="text" id="friendName" placeholder="Friend's Name"><input type="text" id="friendCode" placeholder="Friend's Secret Code" style="margin-top:10px;"></div>
                        <div class="form-group"><label>Friend's Photo</label><input type="file" id="friendPhotoInput" accept="image/*" style="display:none;"><div class="photo-uploader" onclick="document.getElementById('friendPhotoInput').click();"><span>Click to Upload</span><img id="friendPhotoPreview" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="></div></div>
                        <div class="form-group"><label>GF's Info</label><input type="text" id="gfName" placeholder="GF's Name"><input type="text" id="gfCode" placeholder="GF's Secret Code" style="margin-top:10px;"></div>
                        <div class="form-group"><label>GF's Photo</label><input type="file" id="gfPhotoInput" accept="image/*" style="display:none;"><div class="photo-uploader" onclick="document.getElementById('gfPhotoInput').click();"><span>Click to Upload</span><img id="gfPhotoPreview" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="></div></div>
                        <button class="btn" id="generateBtn" type="button">Initialize Secure Link</button>
                    </div>
                </form>
            </div>
        </div>
        <!-- Manage Users Panel -->
        <div id="manage" class="panel"><div id="user-list"></div></div>
    </div>
    <nav class="bottom-nav">
        <button class="nav-btn active" data-target="dashboard">Dashboard</button>
        <button class="nav-btn" data-target="manage">Manage Users</button>
    </nav>
    <div id="editModal" class="modal">
        <div class="modal-content"><span class="close-btn" onclick="closeModal()">&times;</span><h2 id="modalTitle">Edit Passwords</h2><input type="hidden" id="editUserId"><div class="form-group"><label id="friendPassLabel" for="friendPass"></label><input type="text" id="friendPass"></div><div class="form-group"><label id="gfPassLabel" for="gfPass"></label><input type="text" id="gfPass"></div><button class="btn" style="width:auto;" onclick="saveChanges()">Save Changes</button></div>
    </div>
    <script>
        const DB_KEY = 'chatUsersV7';
        function getDb() { return JSON.parse(localStorage.getItem(DB_KEY)) || []; }
        function saveDb(db) { localStorage.setItem(DB_KEY, JSON.stringify(db)); }
        let friendPhotoData = null; let gfPhotoData = null;
        function handlePhotoUpload(inputId, previewId, dataStore) { const file = document.getElementById(inputId).files[0]; if (!file) return; const reader = new FileReader(); reader.onload = e => { document.getElementById(previewId).src = e.target.result; if (dataStore === 'friend') friendPhotoData = e.target.result; else gfPhotoData = e.target.result; }; reader.readAsDataURL(file); }
        document.getElementById('friendPhotoInput').addEventListener('change', () => handlePhotoUpload('friendPhotoInput', 'friendPhotoPreview', 'friend'));
        document.getElementById('gfPhotoInput').addEventListener('change', () => handlePhotoUpload('gfPhotoInput', 'gfPhotoPreview', 'gf'));
        document.getElementById('generateBtn').addEventListener('click', () => {
            const friendName = document.getElementById('friendName').value, friendCode = document.getElementById('friendCode').value, gfName = document.getElementById('gfName').value, gfCode = document.getElementById('gfCode').value;
            if (!friendName || !friendCode || !gfName || !gfCode || !friendPhotoData || !gfPhotoData) { alert('Please fill all fields and upload both photos.'); return; }
            const newUser = { id: 'user_' + Date.now(), friendName, gfName, friendCode, gfCode, friendPhoto: friendPhotoData, gfPhoto: gfPhotoData };
            let users = getDb(); users.push(newUser); saveDb(users); alert('New Chat Room Created!');
            document.getElementById('create-user-form').reset(); document.getElementById('friendPhotoPreview').src = 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs='; document.getElementById('gfPhotoPreview').src = 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs='; friendPhotoData = null; gfPhotoData = null; renderUsers();
        });
        function renderUsers() {
            const users = getDb(); const userList = document.getElementById('user-list'); userList.innerHTML = '';
            if (users.length === 0) { userList.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No users found. Create one from the Dashboard.</p>'; return; }
            users.forEach(user => { userList.innerHTML += `<div class="user-card"><div><div class="photos"><img src="${user.friendPhoto}"><img src="${user.gfPhoto}" style="margin-left: -30px;"></div><h3>${user.friendName} & ${user.gfName}</h3></div><div class="actions"><button class="btn-manage" onclick="openModal('${user.id}')">Manage</button><button class="btn-delete" onclick="deleteUser('${user.id}')">Delete</button></div></div>`; });
        }
        window.deleteUser = function(userId) { if (confirm('Are you sure you want to delete this chat room permanently? This action cannot be undone.')) { let users = getDb(); users = users.filter(user => user.id !== userId); saveDb(users); localStorage.removeItem(`chatHistory_${userId}`); localStorage.removeItem(`disappearing_${userId}`); alert('User and all associated data deleted.'); renderUsers(); } }
        const modal = document.getElementById('editModal');
        window.openModal = function(userId) { const user = getDb().find(u => u.id === userId); document.getElementById('editUserId').value = user.id; document.getElementById('modalTitle').innerText = `Edit: ${user.friendName} & ${user.gfName}`; document.getElementById('friendPassLabel').innerText = `${user.friendName}'s Code:`; document.getElementById('friendPass').value = user.friendCode; document.getElementById('gfPassLabel').innerText = `${user.gfName}'s Code:`; document.getElementById('gfPass').value = user.gfCode; modal.style.display = 'flex'; }
        window.closeModal = function() { modal.style.display = 'none'; }
        window.saveChanges = function() { const userId = document.getElementById('editUserId').value; let users = getDb(); const userIndex = users.findIndex(u => u.id === userId); users[userIndex].friendCode = document.getElementById('friendPass').value; users[userIndex].gfCode = document.getElementById('gfPass').value; saveDb(users); alert('Passwords updated!'); closeModal(); renderUsers(); }
        document.querySelectorAll('.nav-btn').forEach(btn => btn.addEventListener('click', () => { document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); document.querySelectorAll('.panel').forEach(p => p.classList.remove('active')); document.getElementById(btn.dataset.target).classList.add('active'); }));
        (function init() {
            if (getDb().length === 0) {
                const dummyMale = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzU4YTZmZiIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxjaXJjbGUgY3g9IjEyIiBjeT0iNyIgcj0iNCIvPjxwYXRoIGQ9Ik02IDE4djJhMiAyIDAgMCAwIDIgMmg4YTIgMiAwIDAgMCAyLTJ2LTJjMC0yLjIxLTEuNjEtNC00LTRIOTAxLjc5IDQgNC00eiIvPjwvc3ZnPg==';
                const dummyFemale = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2U4NWM3ZCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1tYWluZWpvaW49InJvdW5kIj48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMCIvPjxwYXRoIGQ9Ik0xNiAxNHMtMS41IDItNCAyLTMuNS0yLTMuNS0yIi8+PHBhdGggZD0iTTkgOWwxIDEtMSAxeiIvPjxwYXRoIGQ9Ik0xNSA5bC0xIDEtMS0xeiIvPjwvc3ZnPg==';
                saveDb([ { id: 'user_1', friendName: 'Rahul', gfName: 'Priya', friendPhoto: dummyMale, gfPhoto: dummyFemale, friendCode: 'rahul123', gfCode: 'priya456' }, { id: 'user_2', friendName: 'Aman', gfName: 'Sneha', friendPhoto: dummyMale, gfPhoto: dummyFemale, friendCode: 'aman789', gfCode: 'sneha101' } ]);
            }
            renderUsers();
        })();
    </script>
</body>
</html>