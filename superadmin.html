<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>सुपर एडमिन डैशबोर्ड</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap');
        :root{--primary:#0d6efd; --success:#198754; --danger:#dc3545; --warning:#ffc107; --light-gray:#f4f7f9; --border-color: #e9ecef; --text-dark: #212529; --text-light: #6c757d;}
        body{font-family:'Poppins',sans-serif;background-color:var(--light-gray);margin:0 0 80px 0; color: var(--text-dark);}
        
        .view{display:none; padding:20px; animation: fadeIn 0.4s;} .view.active{display:block;} @keyframes fadeIn{from{opacity:0;} to{opacity:1;}}

        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:20px;}
        .stat-card{background:#fff;border-radius:12px;padding:25px;display:flex;align-items:center;gap:20px;box-shadow:0 4px 20px rgba(0,0,0,.05);}
        .stat-card .icon{font-size:24px;width:60px;height:60px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;}
        .stat-card.total-clients .icon{background:var(--primary);}
        .stat-card.total-stores .icon{background:var(--success);}
        .stat-card .info h3{margin:0;font-size:16px;color:var(--text-light);}
        .stat-card .info p{margin:5px 0 0;font-size:28px;font-weight:600;}

        .client-grid{display:grid;grid-template-columns:repeat(auto-fit, minmax(300px, 1fr));gap:20px;}
        .client-card{background:#fff;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,.05);padding:20px; cursor:pointer; transition:all .2s ease;}
        .client-card:hover{transform:translateY(-4px);box-shadow:0 8px 25px rgba(0,0,0,.08);}
        .client-card h4{margin:0 0 5px;font-size:18px;}
        .client-card p{margin:0;color:var(--text-light);font-size: 14px;}
        .client-card.blocked h4{text-decoration: line-through; color: var(--text-light);}
        
        .btn{border:none;padding:10px 18px;border-radius:8px;cursor:pointer;font-weight:600;font-size: 14px; display: inline-flex; align-items: center; gap: 8px;}
        .btn-danger{background:var(--danger);color:#fff;} .btn-warning{background:var(--warning);color:#fff;} .btn-secondary{background:#6c757d;color:#fff;} .btn-success{background:var(--success);color:#fff;} .btn-primary{background:var(--primary);color:#fff;}
        
        .modal{display:none;position:fixed;z-index:1001;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,0.6);animation:fadeIn 0.3s}
        .modal-content{background-color:#fff;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);padding:25px;border-radius:12px;width:90%;max-width:450px;}
        .modal-header{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #eee;padding-bottom:15px;margin-bottom:20px}
        .modal-header h2{margin:0;font-size:20px}
        .close-btn{font-size:28px;cursor:pointer;color:#888}
        .form-group input{width:100%;padding:14px;border:1px solid #ccc;border-radius:8px;box-sizing:border-box;font-size:16px;margin-bottom:15px;}
        .btn-submit{width:100%;padding:14px;background:var(--primary);color:#fff;border:none;border-radius:8px;font-size:1.1em;font-weight:600;cursor:pointer;}
        
        .bottom-nav{position:fixed;bottom:0;left:0;width:100%;background:#fff;box-shadow:0 -2px 15px rgba(0,0,0,.1);display:flex;justify-content:space-around;padding:10px 0; z-index: 100;}
        .nav-btn{background:none;border:none;color:var(--text-light);display:flex;flex-direction:column;align-items:center;gap:4px;font-size:12px;padding:5px 20px; cursor: pointer; flex-grow: 1;}
        .nav-btn i{font-size:22px;}
        .nav-btn.active{color:var(--primary);}
        #add-fab{position:fixed;bottom:80px;right:20px;width:60px;height:60px;background:var(--success);color:#fff;border:none;border-radius:50%;box-shadow:0 4px 15px rgba(0,0,0,.2);font-size:28px;display:flex;align-items:center;justify-content:center;cursor:pointer; z-index: 101;}
        
        .notification{display:none;position:fixed;top:20px;left:50%;transform:translateX(-50%);background-color:var(--success);color:white;padding:15px 25px;border-radius:8px;box-shadow:0 4px 15px rgba(0,0,0,.2);z-index:2000;animation:slideIn .3s both}
        @keyframes slideIn{from{transform:translate(-50%,-100px);opacity:0}to{transform:translate(-50%,0);opacity:1}}
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
</head>
<body>
    <main>
        <div id="home-view" class="view active">
            <h1 style="text-align: left; margin-bottom: 20px;">डैशबोर्ड</h1>
            <div class="stats-grid">
                <div class="stat-card total-clients"><div class="icon"><i class="fa-solid fa-users"></i></div><div class="info"><h3>कुल क्लाइंट्स</h3><p id="total-clients">0</p></div></div>
                <div class="stat-card total-stores"><div class="icon"><i class="fa-solid fa-store"></i></div><div class="info"><h3>कुल स्टोर्स</h3><p id="total-stores">0</p></div></div>
            </div>
        </div>

        <div id="manage-view" class="view">
            <div id="client-list-page">
                <h1 style="text-align: left; margin-bottom: 20px;">सभी क्लाइंट्स</h1>
                <div id="client-grid" class="client-grid"></div>
            </div>
            <div id="client-detail-page" style="display:none;">
                <button id="back-to-clients-btn" class="btn btn-secondary" style="margin-bottom: 20px;">← सभी क्लाइंट्स</button>
                <div id="client-details" class="stat-card" style="display:block; padding: 20px;"></div>
                <div id="client-actions" style="margin-top: 20px; display: flex; gap: 10px;"></div>
                <div id="client-stores" class="stat-card" style="display: block; margin-top:20px;"></div>
            </div>
        </div>
    </main>

    <button id="add-fab">+</button>
    <div id="add-client-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2 id="modal-title">नया क्लाइंट जोड़ें</h2><span class="close-btn">&times;</span></div>
            <div class="modal-body">
                <form id="add-client-form">
                    <div class="form-group"><input type="text" id="client-name" placeholder="क्लाइंट का पूरा नाम" required></div>
                    <div class="form-group"><input type="text" id="razorpay-key" placeholder="Razorpay Key ID (या 'COD' लिखें)" required></div>
                    <button type="submit" class="btn-submit">क्लाइंट जोड़ें</button>
                </form>
            </div>
        </div>
    </div>
    <nav class="bottom-nav">
        <button class="nav-btn active" id="nav-home"><i class="fa-solid fa-house"></i><span>होम</span></button>
        <button class="nav-btn" id="nav-manage"><i class="fa-solid fa-users"></i><span>मैनेज</span></button>
    </nav>
    <div id="notification" class="notification"></div>
    <audio id="success-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" preload="auto"></audio>

    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-database.js"></script>
    <script>
  const firebaseConfig = {
    apiKey: "AIzaSyCZAoe1zoWGZk7A1WLFxdR4T67ntvmFIfY",
    authDomain: "my-client-stores.firebaseapp.com",
    databaseURL: "https://my-client-stores-default-rtdb.firebaseio.com",
    projectId: "my-client-stores",
    storageBucket: "my-client-stores.firebasestorage.app",
    messagingSenderId: "658459339073",
    appId: "1:658459339073:web:37fa1b05e06c09c14119c0",
    measurementId: "G-N8MVEE3B19"
  };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const clientsRef = database.ref('clients');
        const productsRef = database.ref('products');

        const navHome = document.getElementById('nav-home');
        const navManage = document.getElementById('nav-manage');
        const addFab = document.getElementById('add-fab');
        const modal = document.getElementById('add-client-modal');
        const closeBtn = document.querySelector('.close-btn');

        navHome.onclick = () => showView('home');
        navManage.onclick = () => showView('manage');
        addFab.onclick = () => modal.style.display = 'block';
        closeBtn.onclick = () => modal.style.display = 'none';
        
        function showView(viewName) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`${viewName}-view`).classList.add('active');
            document.getElementById(`nav-${viewName}`).classList.add('active');
            if (viewName === 'manage') {
                document.getElementById('client-list-page').style.display = 'block';
                document.getElementById('client-detail-page').style.display = 'none';
            }
        }

        clientsRef.on('value', (snapshot) => {
            const clients = snapshot.val();
            renderClientGrid(clients);
            updateDashboardStats(clients);
        });
        
        productsRef.on('value', (snapshot) => {
            const productsByClient = snapshot.val();
            let totalStores = 0;
            if (productsByClient) {
                Object.values(productsByClient).forEach(clientProducts => {
                    totalStores += Object.keys(clientProducts).length;
                });
            }
            document.getElementById('total-stores').innerText = totalStores;
        });

        function updateDashboardStats(clients) {
            const clientCount = clients ? Object.keys(clients).length : 0;
            document.getElementById('total-clients').innerText = clientCount;
        }

        function renderClientGrid(clients) {
            const grid = document.getElementById('client-grid');
            grid.innerHTML = !clients ? '<p>अभी कोई क्लाइंट नहीं है।</p>' : '';
            if (!clients) return;
            for (const clientId in clients) {
                const client = clients[clientId];
                const card = document.createElement('div');
                card.className = `client-card ${client.status === 'blocked' ? 'blocked' : ''}`;
                card.onclick = () => showClientDetails(clientId, client);
                card.innerHTML = `<h4>${client.name}</h4><p>ID: ${clientId}</p>`;
                grid.appendChild(card);
            }
        }
        
        function showClientDetails(clientId, client) {
            document.getElementById('client-list-page').style.display = 'none';
            document.getElementById('client-detail-page').style.display = 'block';
            
            document.getElementById('client-details').innerHTML = `<div class="info"><h3>${client.name}</h3><p>${client.razorpayKeyId}</p></div>`;
            
            const blockBtnText = client.status === 'blocked' ? 'Unblock' : 'Block';
            const blockBtnClass = client.status === 'blocked' ? 'btn-success' : 'btn-warning';
            document.getElementById('client-actions').innerHTML = `
                <button class="btn btn-primary" onclick="createStore('${clientId}')"><i class="fa-solid fa-store"></i> स्टोर बनाएं</button>
                <button class="btn ${blockBtnClass}" onclick="toggleClientStatus('${clientId}')">${blockBtnText}</button>
                <button class="btn btn-danger" onclick="deleteClient('${clientId}', '${client.name}')"><i class="fa-solid fa-trash-can"></i> डिलीट</button>
            `;
            
            productsRef.child(clientId).on('value', snapshot => {
                const stores = snapshot.val();
                const storesContainer = document.getElementById('client-stores');
                storesContainer.innerHTML = '<h3>स्टोर्स</h3>';
                if (!stores) {
                    storesContainer.innerHTML += '<p>इस क्लाइंट के लिए कोई स्टोर नहीं है।</p>';
                    return;
                }
                for (const productId in stores) {
                    storesContainer.innerHTML += `<div style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #eee;"><span>${stores[productId].name}</span><button class="btn-danger" style="padding:5px 10px;" onclick="deleteStore('${clientId}','${productId}')">डिलीट</button></div>`;
                }
            });
        }
        
        document.getElementById('back-to-clients-btn').onclick = () => { showView('manage'); };
        
        document.getElementById('add-client-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const clientName = document.getElementById('client-name').value;
            const razorpayKey = document.getElementById('razorpay-key').value;
            const clientId = clientName.toLowerCase().replace(/\s+/g, '-');
            clientsRef.child(clientId).set({ name: clientName, razorpayKeyId: razorpayKey, status: 'active' }).then(() => { showNotification('✅ क्लाइंट सफलतापूर्वक जोड़ा गया!'); });
            document.getElementById('add-client-form').reset();
            modal.style.display = 'none';
        });

        function deleteClient(clientId, clientName) {
            if (confirm(`क्या आप वाकई '${clientName}' को हटाना चाहते हैं?`)) {
                clientsRef.child(clientId).remove().then(() => { showNotification('🗑️ क्लाइंट हटा दिया गया!', false); showView('manage'); });
                productsRef.child(clientId).remove(); // उसके सारे स्टोर भी डिलीट कर दें
            }
        }
        
        function toggleClientStatus(clientId) {
            clientsRef.child(clientId + '/status').once('value', snapshot => {
                const newStatus = snapshot.val() === 'active' ? 'blocked' : 'active';
                clientsRef.child(clientId + '/status').set(newStatus).then(() => {
                    showNotification(`क्लाइंट ${newStatus === 'active' ? 'अनब्लॉक' : 'ब्लॉक'} हो गया है!`);
                });
            });
        }

        function deleteStore(clientId, productId) {
            if(confirm('क्या आप वाकई इस स्टोर को हटाना चाहते हैं?')) {
                productsRef.child(clientId).child(productId).remove().then(() => {
                    showNotification('स्टोर हटा दिया गया!', false);
                });
            }
        }
        
        function createStore(clientId) { window.location.href = `generator.html?clientId=${encodeURIComponent(clientId)}`; }
        
        function showNotification(message, isSuccess = true) {
            const n = document.getElementById('notification');
            n.textContent = message; n.style.backgroundColor = isSuccess ? 'var(--success)' : 'var(--danger)'; n.style.display = 'block';
            if(isSuccess) document.getElementById('success-sound').play();
            setTimeout(()=> n.style.display = 'none', 4000);
        }
    </script>
</body>
</html>