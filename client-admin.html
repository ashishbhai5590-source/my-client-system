<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>ऑर्डर डैशबोर्ड</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap');
        :root{--primary:#0d6efd; --success:#198754; --warning:#ffc107; --light-gray:#f4f7f9; --border-color: #e9ecef; --text-dark: #212529; --text-light: #6c757d;}
        body{font-family:'Poppins',sans-serif;background-color:var(--light-gray);margin:0 0 80px 0; color: var(--text-dark);}
        
        .view{display:none; padding:20px; animation: fadeIn 0.4s;}
        .view.active{display:block;}
        @keyframes fadeIn{from{opacity:0;} to{opacity:1;}}

        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:20px;margin-bottom:25px;}
        .stat-card{background:#fff;border-radius:12px;padding:25px;display:flex;align-items:center;gap:20px;box-shadow:0 4px 20px rgba(0,0,0,.05);}
        .stat-card .icon{font-size:24px;width:60px;height:60px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;}
        .stat-card.total-orders .icon{background:var(--primary);}
        .stat-card.total-revenue .icon{background:var(--success);}
        .stat-card.pending-orders .icon{background:var(--warning);}
        .stat-card .info h3{margin:0;font-size:16px;color:var(--text-light);}
        .stat-card .info p{margin:5px 0 0;font-size:28px;font-weight:600;}

        #customer-grid{display:grid;grid-template-columns:repeat(auto-fit, minmax(300px, 1fr));gap:20px;}
        .customer-card{background:#fff;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,.05);padding:20px;cursor:pointer;transition:all .2s ease;}
        .customer-card:hover{transform:translateY(-4px);box-shadow:0 8px 25px rgba(0,0,0,.08);}
        .customer-card h4{margin:0 0 5px;font-size:18px;}
        .customer-card p{margin:0;color:var(--text-light);}

        /* --- बदला हुआ: डिटेल आइटम CSS --- */
        .detail-item{padding: 10px 0; display: flex; align-items: center; gap: 15px; border-bottom: 1px solid var(--border-color);}
        .detail-item:last-child{border-bottom:none;}
        .detail-item i{font-size:18px;color:var(--primary);width:20px;text-align:center;}
        .detail-item .label{font-size:14px;color:#666; min-width: 60px;}
        .detail-item .value{font-size:16px;font-weight:500;}

        .order-history-card{background:#fff;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,.05);margin-top:20px;padding:20px;}
        .order-history-card h4{margin-top:0;}
        .history-item{background: #f8f9fa; padding:15px;border:1px solid var(--border-color);border-radius:12px;margin-bottom:15px;}
        .history-item-header{display:flex;justify-content:space-between;align-items:center; margin-bottom:15px;}
        .history-item-header span{font-size: 16px; font-weight: 500;}
        .history-item-actions{display:flex; align-items: center; gap: 10px; margin-bottom: 10px;}
        select{flex-grow: 1; padding:12px;border-radius:8px;border:1px solid #ccc;font-size: 16px; background-color: #fff;}
        textarea{width:100%; padding:12px;border-radius:8px;border:1px solid #ccc;font-size: 15px; box-sizing: border-box;}
        .btn-notify{background:var(--success);color:#fff;border:none;padding:12px;border-radius:8px;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:2px;font-size: 12px; width: 60px;}
        .btn-notify span {font-size: 20px;}
        .btn-back{background:#6c757d;color:#fff;border:none;padding:8px 15px;border-radius:6px;cursor:pointer; margin-bottom: 20px;}
        
        .status-badge{padding:6px 16px;border-radius:20px;color:#fff;font-size:14px;font-weight:500;}
        .status-processing{background-color:var(--primary);}
        .status-shipped{background-color:var(--warning); color:#333;}
        .status-delivered{background-color:var(--success);}

        .bottom-nav{position:fixed;bottom:0;left:0;width:100%;background:#fff;box-shadow:0 -2px 15px rgba(0,0,0,.1);display:flex;justify-content:space-around;padding:10px 0; z-index: 100;}
        .nav-btn{background:none;border:none;color:var(--text-light);display:flex;flex-direction:column;align-items:center;gap:4px;font-size:12px;padding:5px 20px; cursor: pointer;}
        .nav-btn i{font-size:22px;}
        .nav-btn.active{color:var(--primary);}
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
</head>
<body>
    <main>
        <div id="home-view" class="view active">
            <div class="stats-grid">
                <div class="stat-card total-orders"><div class="icon"><i class="fa-solid fa-box-archive"></i></div><div class="info"><h3>कुल ऑर्डर्स</h3><p id="total-orders">0</p></div></div>
                <div class="stat-card total-revenue"><div class="icon"><i class="fa-solid fa-indian-rupee-sign"></i></div><div class="info"><h3>कुल बिक्री</h3><p id="total-revenue">0</p></div></div>
                <div class="stat-card pending-orders"><div class="icon"><i class="fa-solid fa-hourglass-half"></i></div><div class="info"><h3>प्रोसेसिंग</h3><p id="pending-orders">0</p></div></div>
            </div>
        </div>

        <div id="manage-view" class="view">
            <div id="customer-list-page">
                <h1 style="text-align: left; margin-bottom: 20px;">सभी ग्राहक</h1>
                <div id="customer-grid"></div>
            </div>
            <div id="customer-detail-page" style="display:none;">
                <button id="back-to-customers-btn" class="btn-back">← सभी ग्राहक</button>
                <div id="customer-details" class="order-history-card"></div>
                <div class="order-history-card">
                    <h4>ऑर्डर हिस्ट्री</h4>
                    <div id="customer-orders-history"></div>
                </div>
            </div>
        </div>
    </main>

    <nav class="bottom-nav">
        <button class="nav-btn active" id="nav-home"><i class="fa-solid fa-house"></i><span>होम</span></button>
        <button class="nav-btn" id="nav-manage"><i class="fa-solid fa-users"></i><span>मैनेज</span></button>
    </nav>

    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-database.js"></script>
    <script>
        // ============== अपनी Firebase Keys यहाँ पेस्ट करें ==============
   const firebaseConfig = {
    apiKey: "AIzaSyCZAoe1zoWGZk7A1WLFxdR4T67ntvmFIfY",
    authDomain: "my-client-stores.firebaseapp.com",
    databaseURL: "https://my-client-stores-default-rtdb.firebaseio.com",
    projectId: "my-client-stores",
    storageBucket: "my-client-stores.firebasestorage.app",
    messagingSenderId: "658459339073",
    appId: "1:658459339073:web:37fa1b05e06c09c14119c0",
    measurementId: "G-N8MVEE3B19"
  };
        // ==============================================================
        
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const params = new URLSearchParams(window.location.search);
        const clientId = params.get('clientId'); const productId = params.get('productId');
        let allOrders = {}, allCustomers = {};

        const navHome = document.getElementById('nav-home');
        const navManage = document.getElementById('nav-manage');
        const homeView = document.getElementById('home-view');
        const manageView = document.getElementById('manage-view');
        
        navHome.onclick = () => showView('home');
        navManage.onclick = () => showView('manage');

        function showView(viewName) {
            homeView.classList.remove('active'); manageView.classList.remove('active');
            navHome.classList.remove('active'); navManage.classList.remove('active');
            if(viewName === 'home') { homeView.classList.add('active'); navHome.classList.add('active'); } 
            else { 
                manageView.classList.add('active'); navManage.classList.add('active');
                document.getElementById('customer-list-page').style.display = 'block';
                document.getElementById('customer-detail-page').style.display = 'none';
            }
        }

        if (clientId && productId) {
            const ordersRef = database.ref(`orders/${clientId}/${productId}`);
            ordersRef.on('value', (snapshot) => {
                if (!snapshot.exists()) {
                    document.getElementById('home-view').innerHTML = '<h3 style="text-align:center;">अभी कोई ऑर्डर नहीं है।</h3>';
                    return;
                }
                allOrders = snapshot.val();
                
                allCustomers = {};
                Object.keys(allOrders).forEach(orderId => {
                    const order = allOrders[orderId];
                    if (!allCustomers[order.customer_phone]) {
                        allCustomers[order.customer_phone] = { name: order.customer_name, phone: order.customer_phone, address: `${order.customer_address}, ${order.customer_pincode}`, orders: [] };
                    }
                    allCustomers[order.customer_phone].orders.push(orderId);
                });
                updateDashboardStats();
                renderCustomerGrid();
            });
        }

        function updateDashboardStats() {
            const orders = Object.values(allOrders);
            document.getElementById('total-orders').innerText = orders.length;
            const totalRevenue = orders.reduce((sum, order) => sum + (order.productPrice || 0), 0);
            document.getElementById('total-revenue').innerText = totalRevenue.toLocaleString('en-IN');
            const pendingOrders = orders.filter(order => order.status === 'Processing').length;
            document.getElementById('pending-orders').innerText = pendingOrders;
        }

        function renderCustomerGrid() {
            const grid = document.getElementById('customer-grid'); grid.innerHTML = '';
            Object.values(allCustomers).forEach(customer => {
                const card = document.createElement('div'); card.className = 'customer-card';
                card.onclick = () => showCustomerDetails(customer.phone);
                card.innerHTML = `<h4>${customer.name}</h4><p>${customer.phone}</p>`;
                grid.appendChild(card);
            });
        }

        function showCustomerDetails(phone) {
            document.getElementById('customer-list-page').style.display = 'none'; document.getElementById('customer-detail-page').style.display = 'block';
            const customer = allCustomers[phone];
            document.getElementById('customer-details').innerHTML = `
                <div class="detail-item"><i class="fa-solid fa-user"></i><div class="label">नाम:</div><div class="value">${customer.name}</div></div>
                <div class="detail-item"><i class="fa-solid fa-phone"></i><div class="label">फोन:</div><div class="value">${customer.phone}</div></div>
                <div class="detail-item"><i class="fa-solid fa-location-dot"></i><div class="label">पता:</div><div class="value">${customer.address}</div></div>
            `;
            
            const historyContainer = document.getElementById('customer-orders-history'); historyContainer.innerHTML = '';
            customer.orders.forEach(orderId => {
                const order = allOrders[orderId]; let statusBadge = '';
                if (order.status === 'Processing') statusBadge = '<span class="status-badge status-processing">Placed</span>';
                else if (order.status === 'Shipped') statusBadge = '<span class="status-badge status-shipped">Shipped</span>';
                else if (order.status === 'Delivered') statusBadge = '<span class="status-badge status-delivered">Delivered</span>';

                const historyItem = document.createElement('div'); historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <div class="history-item-header"><span>ऑर्डर ID: ...${orderId.slice(-6)}</span>${statusBadge}</div>
                    <textarea id="message-${orderId}" placeholder="ग्राहक के लिए मैसेज (वैकल्पिक)...">${order.customMessage || ''}</textarea>
                    <div class="history-item-actions">
                        <select id="status-${orderId}">
                            <option value="Processing" ${order.status === 'Processing' ? 'selected' : ''}>Placed</option>
                            <option value="Shipped" ${order.status === 'Shipped' ? 'selected' : ''}>Shipped</option>
                            <option value="Delivered" ${order.status === 'Delivered' ? 'selected' : ''}>Delivered</option>
                        </select>
                        <button class="btn-notify" onclick="updateOrderStatus('${orderId}', '${phone}')"><span>🔔</span><span>भेजें</span></button>
                    </div>`;
                historyContainer.appendChild(historyItem);
            });
        }
        
        document.getElementById('back-to-customers-btn').onclick = () => { document.getElementById('customer-list-page').style.display = 'block'; document.getElementById('customer-detail-page').style.display = 'none'; };

        function updateOrderStatus(orderId, customerPhone) {
            const newStatus = document.getElementById(`status-${orderId}`).value;
            const newCustomMessage = document.getElementById(`message-${orderId}`).value;
            const updateData = { status: newStatus, customMessage: newCustomMessage || null };
            
            database.ref(`orders/${clientId}/${productId}/${orderId}`).update(updateData);
            database.ref(`tracking/${customerPhone}`).update(updateData);
            alert('ऑर्डर और नोटिफिकेशन सफलतापूर्वक अपडेट हो गया है!');
        }
    </script>
</body>
</html>