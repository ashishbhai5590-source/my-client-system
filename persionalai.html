<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>अल्टीमेट AI असिस्टेंट</title>
    <style>
        /* CSS कोड पहले जैसा ही है, कोई बदलाव नहीं */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');
        :root { --bg-color: #121829; --orb-color: #16213e; --glow-color: #00aaff; --text-primary: #ecf0f1; --text-secondary: #95a5a6; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg-color); color: var(--text-primary); margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; text-align: center; overflow: hidden; }
        .container { display: flex; flex-direction: column; align-items: center; padding: 20px; opacity: 0; animation: fadeIn 1.5s forwards; }
        @keyframes fadeIn { to { opacity: 1; } }
        #ai-orb { width: 150px; height: 150px; border-radius: 50%; background: radial-gradient(circle at 30% 30%, #4a6fa5, var(--orb-color)); cursor: pointer; display: flex; justify-content: center; align-items: center; position: relative; transition: transform 0.2s ease; border: 3px solid #34495e; }
        #ai-orb::before { content: ''; position: absolute; width: 100%; height: 100%; border-radius: 50%; transition: box-shadow 0.5s ease; }
        #ai-orb.idle::before { animation: idle-glow 3s infinite alternate; }
        #ai-orb.listening::before { animation: listening-pulse 1.5s infinite; }
        #ai-orb.speaking::before { animation: speaking-glow 1s infinite alternate; }
        #mic-icon { width: 50px; height: 50px; fill: var(--text-primary); }
        @keyframes idle-glow { from { box-shadow: 0 0 15px -5px var(--glow-color); } to { box-shadow: 0 0 30px 5px var(--glow-color); } }
        @keyframes listening-pulse { 0% { box-shadow: 0 0 0 0 rgba(0, 170, 255, 0.7); } 70% { box-shadow: 0 0 0 40px rgba(0, 170, 255, 0); } 100% { box-shadow: 0 0 0 0 rgba(0, 170, 255, 0); } }
        @keyframes speaking-glow { from { box-shadow: 0 0 20px 0px #2ecc71; } to { box-shadow: 0 0 40px 10px #2ecc71; } }
        #status { font-size: 1.4em; margin-top: 40px; font-weight: 400; height: 30px; }
        #transcript { margin-top: 15px; font-size: 1em; color: var(--text-secondary); min-height: 40px; max-width: 80vw; font-weight: 300; }
    </style>
</head>
<body>
    <div class="container">
        <div id="ai-orb" class="idle"><svg id="mic-icon" viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.49 6-3.31 6-6.72h-1.7z"/></svg></div>
        <h2 id="status">एक्टिवेट करने के लिए टैप करें</h2>
        <p id="transcript"></p>
    </div>

    <script>
        const orb = document.getElementById('ai-orb');
        const statusDiv = document.getElementById('status');
        const transcriptDiv = document.getElementById('transcript');
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        recognition.lang = 'hi-IN';
        recognition.continuous = false;

        let bestHindiVoice = null;
        let isAssistantActive = false;
        let waitingForReturnFromSearch = false; // नया: गूगल सर्च से लौटने का इंतज़ार
        
        let chatState = {
            currentUser: null,
            currentQuestion: 'initial_identity', 
        };

        // --- सभी फंक्शन्स (कोई बदलाव नहीं) ---
        function loadVoices() {
            const voices = window.speechSynthesis.getVoices();
            bestHindiVoice = voices.find(v => v.lang === 'hi-IN' && v.name.includes('Google')) || voices.find(v => v.lang === 'hi-IN');
        }
        window.speechSynthesis.onvoiceschanged = loadVoices;
        loadVoices();
        function setOrbState(state) { orb.className = state; }
        function speak(text, onEndCallback) {
            setOrbState('speaking');
            statusDiv.textContent = 'बोल रही हूँ...';
            const utterance = new SpeechSynthesisUtterance(text);
            if (bestHindiVoice) utterance.voice = bestHindiVoice;
            utterance.lang = 'hi-IN';
            utterance.rate = 0.95;
            utterance.pitch = 1.0;
            utterance.onend = () => { if (onEndCallback) onEndCallback(); };
            window.speechSynthesis.speak(utterance);
        }
        function startListening(nextQuestionState) {
            chatState.currentQuestion = nextQuestionState;
            setOrbState('listening');
            statusDiv.textContent = 'सुन रही हूँ...';
            transcriptDiv.textContent = '';
            try { recognition.start(); } catch(e) {}
        }
        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            transcriptDiv.textContent = `आपने कहा: "${transcript}"`;
            processCommand(transcript);
        };

        // --- मुख्य लॉजिक (सुधारों के साथ) ---
        function processCommand(command) {
            const userText = command.toLowerCase();
            let assistantReply = "";
            setOrbState('thinking');
            statusDiv.textContent = 'सोच रही हूँ...';

            setTimeout(() => {
                switch (chatState.currentQuestion) {
                    
                    // (अन्य सभी केस पहले जैसे ही रहेंगे)
                    case 'initial_identity':
                        if (userText.includes("वीरेंद्र")) {
                            chatState.currentUser = 'veerendra';
                            assistantReply = "नमस्ते वीरेंद्र भैया! मैं आपकी मदद के लिए तैयार हूँ। कृपया बताएं, आपकी पढ़ाई कैसी चल रही है?";
                            speak(assistantReply, () => startListening('study_status'));
                        } else if (userText.includes("सूर्यांश")) {
                            chatState.currentUser = 'suryansh';
                            assistantReply = "अरे सूर्यांश भैया! वीरेंद्र भैया ने मुझे बताया है कि आप बहुत लड़कियों से प्यार करते हैं। सुधर जाओ! खैर, यह सब छोड़ो और बताओ, पढ़ाई कैसी चल रही है?";
                            speak(assistantReply, () => startListening('study_status'));
                        } else {
                            chatState.currentUser = 'unknown';
                            assistantReply = "माफ़ कीजिए, मैंने आपको पहचाना नहीं। क्या आप लड़के हैं या लड़की?";
                            speak(assistantReply, () => startListening('ask_gender'));
                        }
                        break;
                    case 'ask_gender':
                        if (userText.includes("लड़का")) { /*...*/ speak(assistantReply, () => startListening('general_query')); } 
                        else if (userText.includes("लड़की")) { /*...*/ speak(assistantReply, () => startListening('is_janu')); }
                        break;
                    case 'is_janu':
                        if (userText.includes("हाँ")) { /*...*/ speak(assistantReply, () => startListening('general_query')); } 
                        else { /*...*/ speak(assistantReply, () => startListening('ask_insta')); }
                        break;
                    case 'ask_insta':
                        /*...*/ speak(assistantReply, () => startListening('general_query'));
                        break;


                    case 'study_status':
                        // --- सुधार #1: भावनात्मक जवाब ---
                        if (userText.includes("अच्छी") || userText.includes("ठीक") || userText.includes("बढ़िया")) {
                            assistantReply = "बहुत बढ़िया! यह सुनकर मुझे बहुत खुशी हुई। आपकी मेहनत ज़रूर रंग लाएगी। अच्छा, अब यह बताओ, आज सबसे ज़्यादा समय किस ऐप पर और कितने घंटे बिताया?";
                        } else if (userText.includes("खराब") || userText.includes("नहीं") || userText.includes("मन नहीं")) {
                            assistantReply = "ओह, कोई बात नहीं। उतार-चढ़ाव तो आते रहते हैं। हिम्मत मत हारना, मैं तुम्हारी मदद के लिए यहाँ हूँ। वैसे, आज सबसे ज़्यादा समय किस ऐप पर और कितने घंटे बिताया?";
                        } else {
                            assistantReply = "ठीक है, मैंने आपकी बात नोट कर ली है। वैसे, आज सबसे ज़्यादा समय किस ऐप पर और कितने घंटे बिताया?";
                        }
                        speak(assistantReply, () => startListening('ask_screentime'));
                        break;

                    case 'ask_screentime':
                        if (userText.includes("youtube") || userText.includes("इंस्टाग्राम")) {
                            assistantReply = "ये ऐप्स पढ़ाई से बहुत ध्यान भटकाते हैं। इनके इस्तेमाल के लिए एक समय तय करो। अब यह बताओ, लव के चक्कर में तो नहीं पड़े हो?";
                        } else if (userText.includes("गेम")) {
                            assistantReply = "गेम खेलना ठीक है, लेकिन पढ़ाई पहले। पढ़ाई और मनोरंजन में संतुलन बनाना सीखो। अच्छा, यह बताओ, लव के चक्कर में तो नहीं पड़े हो?";
                        } else {
                             assistantReply = "ठीक है। अब एक ज़रूरी सवाल, लव के चक्कर में तो नहीं पड़े हो?";
                        }
                        speak(assistantReply, () => startListening('ask_love'));
                        break;

                    case 'ask_love':
                        if (userText.includes("हाँ") || userText.includes("yes")) {
                            assistantReply = "देखो, यह उम्र करियर बनाने की है। इन सब चक्करों में पड़कर अपना लक्ष्य मत भूलना। ठीक है, अब पढ़ाई से जुड़ा कोई सवाल पूछो।";
                        } else {
                            assistantReply = "बहुत अच्छे! यह सुनकर मुझे बहुत खुशी हुई। तुम अपने लक्ष्य पर केंद्रित हो। चलो, अब पढ़ाई से जुड़ा कोई सवाल पूछो।";
                        }
                        speak(assistantReply, () => startListening('general_query'));
                        break;

                    case 'general_query':
                        if (userText.includes("प्रकाश संश्लेषण")) { assistantReply = "प्रकाश संश्लेषण वह प्रक्रिया है जिसमें हरे पौधे सूर्य के प्रकाश का उपयोग करके अपना भोजन बनाते हैं।"; } 
                        else if (userText.includes("न्यूटन के नियम")) { assistantReply = "न्यूटन ने गति के तीन नियम दिए थे, जो बताते हैं कि कोई वस्तु कैसे चलती है।"; } 
                        else if (userText.includes("कौन हो")) { assistantReply = "मैं आपकी पर्सनल AI असिस्टेंट हूँ।"; } 
                        else if (userText.includes("बंद करो")) { assistantReply = "ठीक है, जब भी ज़रूरत हो, मुझे एक्टिवेट कर लेना।"; isAssistantActive = false; } 
                        else {
                            assistantReply = "यह एक बहुत अच्छा सवाल है। मैं आपके लिए गूगल पर इसकी जानकारी खोज रही हूँ।";
                            speak(assistantReply, () => {
                                waitingForReturnFromSearch = true; // सर्च पर भेजने से पहले फ़्लैग सेट करें
                                window.open(`https://www.google.com/search?q=${encodeURIComponent(command)}`, '_blank');
                                statusDiv.textContent = "सर्च रिजल्ट देखकर वापस आएँ...";
                                setOrbState('idle'); // जब तक आप वापस न आएं, ऑर्ब शांत रहेगा
                            });
                            return; 
                        }
                        
                        if(isAssistantActive) {
                            speak(assistantReply, () => startListening('general_query'));
                        } else {
                           speak(assistantReply, () => { setOrbState('idle'); statusDiv.textContent = 'एक्टिवेट करने के लिए टैप करें'; });
                        }
                        break;
                }
            }, 1000);
        }

        orb.addEventListener('click', () => {
            if (!isAssistantActive) {
                isAssistantActive = true;
                speak("असिस्टेंट एक्टिवेट हो गया है। कृपया बताएं, आप वीरेंद्र भैया हैं या सूर्यांश भैया?", () => startListening('initial_identity'));
            }
        });

        // --- सुधार #2: गूगल सर्च से वापस आने पर बातचीत जारी रखना ---
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible' && waitingForReturnFromSearch) {
                waitingForReturnFromSearch = false; // फ़्लैग को रीसेट करें
                const reengageMessage = "वापस आने के लिए धन्यवाद! क्या आपको आपके सवाल का जवाब मिल गया? आप चाहें तो मुझसे कोई और सवाल पूछ सकते हैं।";
                speak(reengageMessage, () => startListening('general_query'));
            }
        });
    </script>
</body>
</html>